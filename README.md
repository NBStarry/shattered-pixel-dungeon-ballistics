# 破碎像素地牢 - 弹道计算器 v2.0

**双向弹道系统 + 攻击模拟器**

完整模拟《破碎的像素地牢》中的"你打得到敌人，敌人打不到你"核心战术。

## 功能特性

### 🆕 v2.0 新功能

#### 1. 双向弹道系统
- **玩家弹道**：显示玩家→目标的完整路径
  - 🟢 绿色实线：能打到敌人
  - ⚪ 灰色实线：未命中敌人
- **敌人弹道**：同时显示所有敌人→玩家的弹道
  - 🔴 红色实线：危险！敌人能打到你
  - 🟠 橙色虚线：安全，敌人弹道被阻挡

#### 2. 攻击模拟器
- **点击任意格子**：不选择工具时，点击显示弹道
- **实时命中判断**：自动检测弹道路径上的所有敌人
- **智能状态提示**：
  - 🎯 **完美**：你能打敌人，敌人打不到你
  - ⚠️ **警告**：双方都能打到
  - ✅ **安全**：双方都打不到
  - ❌ **危险**：你打不到，但敌人能打到你

#### 3. 核心战术演示
现在可以完整模拟"点击敌人旁边格子打到敌人"的高级技巧！

### v1.0 核心功能
- ✅ **精确弹道计算**：基于游戏源码 `Ballistica.java` 实现
- ✅ **可视化工具**：网格系统，拖放放置实体
- ✅ **多场景支持**：预设7个实战场景
- ✅ **障碍物推荐**：自动计算最佳阻挡位置
- ✅ **移动端优化**：触摸操作支持

## 使用方法

### 🎯 攻击模拟模式（v2.0）

**核心玩法**：模拟"你打得到敌人，敌人打不到你"

1. **放置实体**：
   - 选择"玩家"工具，点击网格放置
   - 选择"敌人"工具，放置一个或多个敌人
   - （可选）放置障碍物和墙体

2. **模拟攻击**：
   - **不选择任何工具**
   - **点击任意格子**作为攻击目标

3. **查看结果**：
   - 🟢 绿色实线：玩家→目标的弹道
   - 绿色圆环：弹道路径上命中的敌人
   - 🔴 红色/🟠橙色：敌人→玩家的弹道
   - 状态栏显示战术评估

4. **高级技巧示例**：
```
场景：玩家(6,10)，敌人(14,10)，障碍物(10,10)
- 点击(14,10)敌人位置 → 弹道被阻挡 ❌
- 点击(14,9)敌人旁边 → 弹道绕过障碍物，命中！✅
- 敌人→玩家弹道被阻挡 → 敌人打不到你 ✅
结果：🎯 完美！你能打敌人，敌人打不到你！
```

### 🛡️ 防御模式（传统）

1. **放置实体**：选择工具，点击网格
   - 🦸 玩家（只能1个）
   - 👹 敌人（可多个）
   - 🛡️ 障碍物
   - 🧱 墙体

2. **计算弹道**：点击"计算弹道"按钮
   - 🔴 红色实线：危险弹道
   - 🟢 绿色虚线：安全（已阻挡）
   - 💡 黄色方块：推荐障碍物位置

3. **调整策略**：放置障碍物，重新计算

### 📚 预设场景

加载场景快速学习战术：
1. **拐角优势** - 墙角卡位战术
2. **门口卡位** - 门框阻挡弹道
3. **对角线技巧** - 利用对角线绕过障碍
4. **草丛掩护** - 障碍物挡视线
5. **天狗战法** - 哨卫/幽妹实战
6. **多敌安全点** - 被包围时的最优位置
7. **点击旁边格子** - 高级技巧示例

## 游戏战术应用

### 什么是"挡弹道"？

在《破碎的像素地牢》中，弹道战术的核心是：
- **防御**：在你和敌人之间放障碍物（哨卫/幽妹/草）
- **进攻**：点击敌人旁边的格子，绕过障碍打到敌人
- **结果**：你能打到敌人，敌人打不到你

### 关键条件
- 敌人必须先"索敌"（锁定你为目标）
- 障碍物必须在弹道路径上
- 理解弹道计算（主轴/副轴步进）

### 常见应用场景
- **天狗战**：哨卫挡弹道，安全输出
- **矮人王**：利用地形和召唤物
- **远程小怪**：草/灵壤守卫挡弹道
- **探图**：用弹道计算预判危险

### 可用障碍物

1. **哨卫**（法杖）⭐⭐⭐⭐⭐
   - 最推荐，可多次放置
2. **幽妹**（神器）⭐⭐⭐⭐
   - 操作性强，可主动拉怪
3. **草**（自然生成）⭐⭐⭐
   - 零成本，位置固定
4. **灵壤守卫**（法杖）⭐⭐⭐
   - 可探图引怪

## 技术实现

### 核心算法

基于游戏源码 `Ballistica.java` 实现：
- **主轴/副轴步进**：完全匹配游戏内弹道
- **碰撞检测**：solid地形前一格碰撞
- **路径遍历**：检测所有路径上的实体

### 技术栈
- 纯HTML5 + JavaScript（无依赖）
- Canvas 2D绘图
- 响应式设计

### 源码参考
```
github.com/00-Evan/shattered-pixel-dungeon/blob/master/
core/src/main/java/com/shatteredpixel/shatteredpixeldungeon/
mechanics/Ballistica.java
```

## 部署

### 在线访问
**GitHub Pages**: https://nbstarry.github.io/shattered-pixel-dungeon-ballistics/

### 本地运行
```bash
# 方法1：一键启动
./start.sh

# 方法2：Python服务器
python3 -m http.server 8000
# 访问 http://localhost:8000

# 方法3：直接打开
open index.html
```

### 手机使用
1. 访问在线地址
2. 点击浏览器菜单"添加到主屏幕"
3. 像原生app一样使用

## 开发记录

### v2.0 (2026-02-27)
- ✅ 双向弹道系统
- ✅ 攻击模拟器
- ✅ 点击显示弹道
- ✅ 命中判断
- ✅ 智能状态提示

### v1.1 (2026-02-27)
- ✅ 修复弹道算法（基于游戏源码）
- ✅ 修复敌人放置bug
- ✅ 重新设计7个实战场景

### v1.0 (2026-02-26)
- ✅ 基础弹道计算
- ✅ 网格编辑器
- ✅ 障碍物推荐
- ✅ 移动端优化

## 贡献

GitHub: https://github.com/NBStarry/shattered-pixel-dungeon-ballistics

欢迎提交Issue和Pull Request！

## 许可

MIT License

---

**Enjoy! 在地牢中无往不利！** 🦞
