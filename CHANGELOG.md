# 破碎像素地牢 - 弹道计算器 更新日志

## v2.1 (2026-02-27)

### ✨ 新功能

#### 撤销/恢复系统
- **UI按钮**：添加"↶ 撤销"和"↷ 恢复"按钮
- **键盘快捷键**：
  - `Ctrl+Z` / `Cmd+Z` - 撤销操作
  - `Ctrl+Shift+Z` / `Cmd+Shift+Z` - 恢复操作
  - `Ctrl+Y` / `Cmd+Y` - 恢复操作（Windows风格）
- **智能历史管理**：
  - 最多保存 50 步操作历史
  - 每次放置/移除实体自动保存状态
  - 加载场景和清空操作也会保存
  - 按钮状态自动更新（无法撤销时变灰）

#### 自动取消工具选择
- 点击"🎯 计算弹道"后，如果发现建议攻击点位（蓝色标记）：
  - 自动取消当前选中的放置工具
  - 清除所有工具按钮的激活状态
  - 用户可以直接点击蓝色点位查看弹道轨迹
  - 状态提示更新为"点击查看弹道"

### 🎯 用户体验优化
- 计算弹道后进入"查看模式"更自然
- 撤销功能让实验更安全，误操作可快速恢复
- 键盘快捷键提升操作效率

---

## v2.0 (2026-02-26)

### ✨ 新功能

#### 双向弹道系统
- **玩家弹道**：绿色实线 = 能命中敌人，灰色实线 = 未命中
- **敌人弹道**：红色实线 = 危险，橙色虚线 = 被阻挡
- **智能判断**：
  - 🎯 完美：你能打到敌人，敌人打不到你
  - ⚠️ 警告：双方都能命中
  - ✅ 安全：双方都打不到
  - ❌ 危险：你打不到敌人，但敌人能打到你

#### 攻击点位推荐
- 蓝色方块标记建议攻击位置
- 数字显示该位置能命中多少敌人
- 只推荐"你能打到敌人且敌人打不到你"的完美点位

#### 点击查看弹道
- 取消工具选择后，点击网格任意位置查看从玩家射向该点的弹道
- 实时显示该点的攻击效果
- 敌人弹道同时更新

### 🐛 Bug修复
- 修复 `addEntity()` 中 typeMap 错误（enemy→enemies）
- 修复弹道算法（基于游戏源码 `Ballistica.java`）：
  - 改为轴主导步进（axis-major stepping）
  - 碰撞检测修正为前一格，而非实心格
- 7个战术场景重新设计，符合实际游戏玩法

### 📚 新增场景
1. 角落优势 - 利用墙角阻挡
2. 门口阻挡 - 走廊战术
3. 对角线妙用 - 几何优势
4. 草丛掩护 - 障碍物利用
5. Tengu战术 - Boss战场景
6. 多敌安全点 - 复杂环境
7. 点击敌人旁边 - 绕过障碍物

---

## v1.0 (2026-02-26)

### ✨ 初始版本

#### 核心功能
- 网格编辑器（20×20）
- 实体放置：玩家、敌人、障碍物、墙体
- 弹道计算：基于游戏源码的精确算法
- 防御位置推荐（黄色标记）

#### 技术特性
- 纯原生实现（HTML5 Canvas + Vanilla JS）
- 移动端触摸优化
- 响应式设计
- 一键启动脚本

#### 预设场景
- 7个战术场景演示
- 场景选择器
- 一键加载

---

## 路线图

### 未来计划
- [ ] 导出/导入自定义场景
- [ ] 更多敌人类型（不同射程）
- [ ] 视野计算（FOV）
- [ ] 伤害计算
- [ ] 移动路径规划

### 已完成
- [x] 双向弹道系统
- [x] 攻击模拟器
- [x] 攻击点位推荐
- [x] 撤销/恢复功能
- [x] 自动切换查看模式
